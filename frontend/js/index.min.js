let lineNumbers=$(".line-numbers"),editor=$("#text-area"),codeViewPre=$("#code-view-pre"),codeView=$("#code-view"),messages=$("#messages"),saveButton=$("#save-button"),newButton=$("#new-button"),apiUrl="http://127.0.0.1:8000";function postPaste(e,t){var n={content:e};$.ajax({type:"POST",url:`${apiUrl}/p/n`,data:JSON.stringify(n),dataType:"json",contentType:"application/json",success:function(e){t(null,e)},error:function(e){t(JSON.parse(e.responseText||'{"data": { "message": "An unkown error occured!" } }'))}})}function getPaste(e,t){$.ajax({type:"GET",url:`${apiUrl}/p/${e}`,contentType:"application/json",success:function(e){t(null,e)},error:function(e){t(JSON.parse(e.responseText||'{"data": { "message": "Unknown error occurred.." } }'))}})}function newPaste(){lineNumbers.html("<div>&gt;</div>"),saveButton.prop("disabled",!1),newButton.prop("disabled",!0),editor.val(""),editor.show(),codeViewPre.hide()}function addMessage(e){let t=$(`<li>${e}</li>`);messages.prepend(t),setTimeout(function(){t.slideUp("fast",function(){$(this).remove()})},3e3)}function createTextLinks(e){return(e||"").replace(/([^\S]|^)(((https?\:\/\/)|(www\.))(\S+))/gi,function(e,t,n){var o=n;return o.match("^https?://")||(o="http://"+o),t+'<a href="'+o+'">'+n+"</a>"})}function viewPaste(e){lineNumbers.html("");for(let t=1;t<=e.split("\n").length;t++)lineNumbers.append(`<div>${t}</div>`);codeView.html(createTextLinks(e)),editor.hide(),codeViewPre.show()}saveButton.click(function(){""!==editor.val()&&postPaste(editor.val(),function(e,t){e?addMessage(e.data.message):window.location.href=`/?id=${t.data.id}`})}),newButton.click(function(){window.location.href="/"}),$(document).ready(function(){let e=new URLSearchParams(window.location.search).get("id");null!=e?getPaste(e,function(e,t){if(e)newPaste();else{let e=t.data.content;viewPaste(hljs.highlightAuto(e).value),saveButton.prop("disabled",!0)}}):newPaste()});
